# Bluepill-CubeMX-PlatformIO-Template

This is a template project for Bluepill (STM32F103C8T6) with FreeRTOS and LED blink

The script (from Reference 1) reads the .project and .cproject file created by STM32Cube and the platformio.ini file to create a build model that can be provided to platformio for building without using the libraries provided by PlatformIO. None of the PlatformIO libraries for CubeMX are used. This should provide a build result comparable to that in STM32CubeIDE.

New Libraries can be copied under "lib" folder as subfolder.

## How to edit this template for other STM32 boards

1. Create an empty folder. eg: D:/Github/example
2. Create new project from STM32CubeMX:

   * Project Name -> example
   * Project location -> D:/Github
   * Application Structure -> Advanced
   * Toolchain / IDE -> STM32CubeIDE
   * Code Generator -> Add necessary files as reference in the toolchain project configuration file
   * Generate peripheral initialization as a pair of .c/.h
3. In STM32CubeMX, click `Generate code`
4. Open folder with VSCode, install PlatformIO extension and use it to Create New Project

   * Project Name -> example
   * Framework -> STM32Cube
   * Location -> D:/Github
5. Copy script file setup_cubemx_env_auto.py to folder
6. In platformio.ini file, add the following under [env]

   ````ini
   extra_scripts = pre:setup_cubemx_env_auto.py
   platform_packages = toolchain-gccarmnoneeabi@1.90301.200702
   lib_deps = STLinkedResources
   ````

7. Delete empty folders generated by PlatformIO:`include/, src/, test/`

8. Use PlatformIO to Build, Upload, Debug

## Common Problem

* For build error: cannot open linker script file: replace python script file `/` with `//`

* Cannot build after git clone: git respository ignored STM libraries. You need to open STM32CubeMX file and click `Generate Code` again before building

## References

1. CubeMX to PlatformIO Script: [https://github.com/jbaumann/pio_and_stm32cubeide](https://github.com/jbaumann/pio_and_stm32cubeide)
